//@version=5
indicator("Simplified Buy Signal Indicator with Close", overlay=true)

// Calculate EMA 70
ema70 = ta.ema(close, 70)

// Plot EMA 70 on the chart
plot(ema70, color=color.blue, title="EMA 70")

// Find the last high (Peak A) and low (Trough B) within the last 50 bars using close price
lookbackPeriod = 50
peakA = ta.highest(close, lookbackPeriod)
troughB = ta.lowest(close, lookbackPeriod)

// Buy signal when price breaks above Peak A from below while above EMA 70
// buySignal = close > ema70 and close > peakA and close[1] <= peakA
buySignal = close > peakA and close[1] <= peakA

// Plot buy signal on chart
plotshape(series=buySignal, location=location.belowbar, color=color.green, style=shape.triangleup, title="Buy Signal", size=size.small)

// Plot Peak A and Trough B for visualization
plot(peakA, color=color.red, style=plot.style_circles, title="Peak A")
plot(troughB, color=color.green, style=plot.style_circles, title="Trough B")

// Alert condition for buy signal
alertcondition(buySignal, title="Buy Signal Alert", message="Price crossed above Peak A from below while above EMA 70")